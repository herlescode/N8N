// Obt√©m os dados de entrada do Google Sheets
const inputData = $input.item.json;
console.log("Dados recebidos:", JSON.stringify(inputData, null, 2));

// Obt√©m a data atual no formato YYYY-MM-DD
const today = new Date().toISOString().split('T')[0];

// Converte a data da planilha para o formato correto (se necess√°rio)
let sheetDate = inputData.data;

// Caso a data esteja em outro formato (exemplo: DD/MM/YYYY), converte para YYYY-MM-DD
if (/\d{2}\/\d{2}\/\d{4}/.test(sheetDate)) {
    const [dia, mes, ano] = sheetDate.split('/');
    sheetDate = `${ano}-${mes}-${dia}`;
}

// Verifica se a data da linha √© igual √† data de hoje ou se a linha ainda n√£o foi postada
if (sheetDate === today || !inputData.postado || inputData.postado === "false") {
    return {
        json: {
            rowData: inputData,
            rowIndex: inputData.row_number, // Mant√©m o √≠ndice da linha original
            sheetData: {
                documentId: inputData.documentId || inputData.sheetId || "ID_DESCONHECIDO",
                sheetName: inputData.sheetName || "Postagens"
            }
        }
    };
}

// Se nenhuma linha dispon√≠vel for encontrada, lan√ßa um erro
throw new Error('üö® Nenhuma linha dispon√≠vel para postagem na planilha. Verifique se h√° dados n√£o postados.');